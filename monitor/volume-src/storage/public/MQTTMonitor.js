(()=>{var e={415:(e,t,n)=>{n(610);const o={f:"offline",n:"online",v:"value"};function s(e,t){if("function"==typeof e)return e;throw new TypeError(`${t} should be a function, but ${typeof e} given`)}function i(e,t){const n=e.pingVal;setTimeout((()=>{n===e.pingVal&&t.close(4102,"ping not received in time")}),e.tick)}function r(e,t){t.forEach((t=>{let n={group:t.g,unit:t.u,idx:t.i,time:t.t,type:o[t.y]};"string"==typeof t.v&&(n.value=t.v);const s=e.sess.groups[n.group];if(s){const t=s[n.unit];t&&(null===t.idx||n.idx===t.idx+1?(t.idx=n.idx,t.type=n.type,t.time=n.time,t.val=n.val):n.idx>t.idx+1&&(e.hist.ivl.push({group:n.group,unit:n.unit,min:t.idx+1,max:n.idx-1}),t.idx=n.idx,t.type=n.type,t.time=n.time,t.val=n.val))}e.onMessage(n),e.hist.ivl.length>0&&!e.hist.isActive&&async function(e){e.hist.isActive=!0;let t=e.hist.ivl.pop();for(;t&&await c(e,t);)t=e.hist.ivl.pop();e.hist.isActive=!1}(e).then((()=>{}))}))}async function c(e,t){for(;;){for(t.div=t.max-t.min<100?t.min:t.max-99;;){const n=await fetch(e.sess.path.hist+`?i=${encodeURIComponent(t.div)}&a=${t.max}&g=${encodeURIComponent(t.group)}&u=${encodeURIComponent(t.unit)}`,{mode:"cors",redirect:"follow",headers:{sess:e.sess.token}});if(200===n.status){r(e,(await n.json()).map((e=>(e.g=t.group,e.u=t.unit,e))));break}if(401===n.status)return e.promise.rej(new Error("Unauthorized")),!1}if(t.div===t.min)return!0;t.max=t.div-1}}function a(e){const t=new WebSocket(e.sess.path.ws),n=()=>{t.send(e.sess.token),i(e,t)},o=i=>{3e3===i.code?e.promise.rej(new Error("Unauthorized")):(e.isConnected&&(e.isConnected=!1,e.onDisconnect(i)),t.removeEventListener("open",n),t.removeEventListener("close",o),t.removeEventListener("message",s),setTimeout((()=>a(e)),1e3))},s=n=>{if(!e.testLoose)try{const o=JSON.parse(n.data);"c"===o.x?(console.log("[CONNECTED]:",o),e.isConnected||(e.pingVal=0,e.isConnected=!0,e.onConnect()),"object"==typeof o.m&&function(e,t){const n=[];for(const e in t)t.hasOwnProperty(e)&&t[e].forEach((([t,o])=>{o&&(o.g=e,o.u=t,n.push(o))}));r(e,n)}(e,o.m)):"p"===o.x?e.pingVal===o.v?(e.pingVal+=1,t.send(JSON.stringify({t:"p",v:o.v})),i(e,t)):t.close(4102,"incorrect ping value"):"d"===o.x&&r(e,o.d)}catch(e){t.close(4102,e.message)}};t.addEventListener("open",n),t.addEventListener("close",o),t.addEventListener("message",s)}e.exports=function(e){const t={promise:{res:null,rej:null},sess:e,onConnect:null,onDisconnect:null,onMessage:null,pingVal:0,isConnected:!1,tick:1e4,hist:{isActive:!1,ivl:[]},testLoose:!1};return{getToken:()=>t.sess.token,testLoose:e=>t.testLoose=e,getGroups:()=>function(e){const t={},n=e.sess.groups;for(const e in n)if(n.hasOwnProperty(e)){const o=n[e],s=[];for(const e in o)o.hasOwnProperty(e)&&s.push(e);t[e]=s}return t}(t),onMessage:e=>function(e,t){e.onMessage=s(t,"onMessage")}(t,e),onConnect:e=>function(e,t){e.onConnect=s(t,"onConnect")}(t,e),onDisconnect:e=>function(e,t){e.onDisconnect=s(t,"onDisconnect")}(t,e),serve:async()=>async function(e){const t=new Promise(((t,n)=>{e.promise.res=t,e.promise.rej=n}));return a(e),t}(t)}}},225:(e,t,n)=>{const o=n(98);"object"==typeof e.exports&&(e.exports=o),"object"==typeof window&&(window.MQTTMonitor=o,window.test="test ok part 3!"),console.log("MQTTMonitor initialized part 3")},98:(e,t,n)=>{const o=n(415),s=n(610);async function i(e,t,n){const o=await fetch(e,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({l:t,p:n})});if(200===o.status)return await o.text();throw 401===o.status?new Error(`wrong credentials for '${t}' login`):new Error(`http error status=${o.status}; text=${o.statusText}`)}async function r(e,t){const n=await fetch(e,{mode:"cors",headers:{sess:t}});if(200!==n.status)throw new Error(`wrong wplace response status=${n.status}, statusText=${n.statusText}`);let o=await n.json();const s={};for(const e in o)if(o.hasOwnProperty(e)){const t=o[e],n={};t.forEach((e=>n[e]={idx:null,type:null,time:null,val:null})),s[e]=n}return s}e.exports=function(e){if(!/^(?:(?:(?:(?:[0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}(?:[0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))|(?:(?:(?:[a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*(?:[A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9]))):(?:(?:6553[0-5])|(?:655[0-2][0-9])|(?:65[0-4][0-9]{2})|(?:6[0-4][0-9]{3})|(?:[1-5][0-9]{4})|(?:[0-5]{1,5})|(?:[0-9]{1,4}))(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2}))+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2}))*)*)?)?$/im.test(e))throw new Error(`uri should consist of host, port and path without scheme, but '${e}' given'`);const t={uri:"/"===e.slice(-1)?e.slice(0,-1):e,path:null,token:null,credentials:null,password:null,isSecure:!0,groups:null},n={credentials:(e,o)=>(function(e,t,n){const o=s.checkString(t,"login"),i=s.checkString(n,"password");e.credentials={login:o,password:i}}(t,e,o),n),session:e=>(function(e,t){e.token=s.checkString(t,"session token")}(t,e),n),isSecure:e=>(function(e,t){e.isSecure=s.checkBool(t,"isSecure")}(t,e),n),finalize:async()=>async function(e){const t=e.isSecure?"wss://":"ws://",n=e.isSecure?"https://":"http://";if(e.path={login:`${n}${e.uri}/login`,ws:`${t}${e.uri}/ws`,wplace:`${n}${e.uri}/wplace`,wplaceLast:`${n}${e.uri}/wplace-last`,hist:`${n}${e.uri}/hist`},e.token)try{e.groups=await r(e.path.wplace,e.token)}catch(t){if(!e.credentials)throw t;{const t=e.password;e.password=null,e.token=await i(e.path.login,e.login,t),e.groups=await r(e.path.wplace,e.token)}}else{if(!e.credentials)throw new Error("one of the following must be specified: token by passing to builder.session() or login/password by passing to builder.credentials()");const t=e.credentials.password;e.password=null,e.token=await i(e.path.login,e.credentials.login,t),e.groups=await r(e.path.wplace,e.token)}return o(e)}(t)};return n}},610:e=>{e.exports={checkString:function(e,t){if("string"==typeof e||e instanceof String)return e;throw new TypeError(`${t} should be a string, but '${typeof e}' given`)},checkBool:function(e,t){if("boolean"==typeof e)return e;throw new TypeError(`${t} should be boolean, but ${typeof e} given`)}}}},t={};!function n(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}(225)})();